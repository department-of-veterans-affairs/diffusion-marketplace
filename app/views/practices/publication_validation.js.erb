var publicationValidation = {
    form: '#form',
    modal: '#practiceEditorPublicationModal',
    practiceSlug: '<%= @practice.slug %>',
    hideModal: 'publication-modal-hidden'
}

// only append the publication modal once
if (!$(publicationValidation.modal).length) {
    $('#main-content').after("<%= escape_javascript(render partial: 'practices/publication_validation_modal', formats: [ :html ]) %>");
}

$(publicationValidation.modal).removeClass(publicationValidation.hideModal);

$(document).on('click', '.back-to-editor-button, .close-publication-modal', function() {
    $(publicationValidation.modal).addClass(publicationValidation.hideModal);
    $(publicationValidation.form).attr('action', `/innovations/${publicationValidation.practiceSlug}`)
})

$(document).on('click', '#publication-modal-save-button', function() {
    $(publicationValidation.modal).addClass(publicationValidation.hideModal);
    $(publicationValidation.form).attr('action', `/innovations/${publicationValidation.practiceSlug}`)
    validateForm({ form: $(publicationValidation.form), railsFireEvent: false });
})

// close the publication modal when the user clicks anywhere outside of it
$('body').off().on('click', function(e) {
    if ($(e.target).parent().attr('id') === 'practiceEditorPublicationModal') {
        $(publicationValidation.modal).addClass(publicationValidation.hideModal);
    }
});