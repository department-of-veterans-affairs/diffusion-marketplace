var CHARACTER_COUNTER_VALID_COLOR =  '#a9aeb1';
var CHARACTER_COUNTER_INVALID_COLOR = '#e52207';
var MAX_LENGTH = 50;

function getAdditionalDocumentCharacterCountOnPageLoad() {
    <% @practice.additional_documents.each do |ad| %>
        var additionalDocumentInput = $("input[counter-id='additional_document_<%= ad.id %>_title']");
        var additionalDocumentCharacterSpan = $("#additional_document_<%= ad.id %>_title_character_count");
        var additionalDocumentCurrentLength = additionalDocumentInput.val().length;
        var additionalDocumentCharacterCounter = '(' + additionalDocumentCurrentLength + '/' + MAX_LENGTH + ' characters)';

        additionalDocumentCharacterSpan.text(additionalDocumentCharacterCounter);

        if (additionalDocumentCurrentLength >= MAX_LENGTH) {
            additionalDocumentCharacterSpan.css('color', CHARACTER_COUNTER_INVALID_COLOR);
        }
    <% end %>
}

function getPublicationCharacterCountOnPageLoad() {
    <% @practice.publications.each do |pub| %>
        var publicationInput = $("input[counter-id='publication_<%= pub.id %>_title']");
        var publicationCharacterSpan = $("#publication_<%= pub.id %>_title_character_count");
        var publicationCurrentLength = publicationInput.val().length;
        var publicationCharacterCounter = '(' + publicationCurrentLength + '/' + MAX_LENGTH + ' characters)';

        publicationCharacterSpan.text(publicationCharacterCounter);

        if (publicationCurrentLength >= MAX_LENGTH) {
            publicationCharacterSpan.css('color', CHARACTER_COUNTER_INVALID_COLOR);
        }
    <% end %>
}

function additionalDocumentCharacterCounter() {
    $(document).on('input', '.additional-document-title-input', function(e) {
        var t = e.target;
        var currentLength = $(t).val().length;

        var additionalDocumentCharacterSpan = $(t).closest('div').find('.additional-document-title-character-count');
        var characterCounter = '(' + currentLength + '/' + MAX_LENGTH + ' characters)';

        additionalDocumentCharacterSpan.css('color', CHARACTER_COUNTER_VALID_COLOR);
        additionalDocumentCharacterSpan.text(characterCounter);

        if (currentLength >= MAX_LENGTH) {
            additionalDocumentCharacterSpan.css('color', CHARACTER_COUNTER_INVALID_COLOR);
        }
    });
}

function publicationCharacterCounter() {
    $(document).on('input', '.publication-title-input', function(e) {
        var t = e.target;
        var currentLength = $(t).val().length;

        var publicationCharacterSpan = $(t).closest('div').find('.publication-title-character-count');
        var characterCounter = '(' + currentLength + '/' + MAX_LENGTH + ' characters)';

        publicationCharacterSpan.css('color', CHARACTER_COUNTER_VALID_COLOR);
        publicationCharacterSpan.text(characterCounter);

        if (currentLength >= MAX_LENGTH) {
            publicationCharacterSpan.css('color', CHARACTER_COUNTER_INVALID_COLOR);
        }
    });
}

function showAdditionalDocumentsFieldsOnPageLoad() {
    <% if @practice.additional_documents.empty? %>
        $('.add-additional-document-link').click();
        $('.practice-editor-additional-document-li').appendTo('#sortable_additional_documents');
        initSortable('#sortable_additional_documents');
    <% end %>
}

function showPublicationsFieldsOnPageLoad() {
    <% if @practice.publications.empty? %>
        $('.add-publication-link').click();
        $('.practice-editor-publication-li').appendTo('#sortable_publications');
        initSortable('#sortable_publications');
    <% end %>
}

function executeDocumentationFunctions() {
    getAdditionalDocumentCharacterCountOnPageLoad();
    getPublicationCharacterCountOnPageLoad();
    additionalDocumentCharacterCounter();
    publicationCharacterCounter();
    showAdditionalDocumentsFieldsOnPageLoad();
    showPublicationsFieldsOnPageLoad();
}

$(document).on('turbolinks:load', executeDocumentationFunctions);