<%

  adoption_groups = {
      'Successful': @diffusion_histories
          .find_all { |dh| dh[:status] == 'Complete' }
          .sort_by { |dh| [dh[:facility]['MailingAddressState'], dh[:facility]['OfficialStationName']] },
      'In-progress': @diffusion_histories
          .find_all { |dh| dh[:status] == 'In progress' }
          .sort_by { |dh| [dh[:facility]['MailingAddressState'], dh[:facility]['OfficialStationName']] },
      'Unsuccessful': @diffusion_histories
          .find_all { |dh| dh[:status] == 'Unsuccessful' }
          .sort_by { |dh| [dh[:facility]['MailingAddressState'], dh[:facility]['OfficialStationName']] }
  }
%>
<div class="usa-accordion usa-accordion--bordered">
  <% adoption_groups.each do |group, histories| %>
    <h2 class="usa-accordion__heading">
      <button class="usa-accordion__button"
              aria-expanded="false"
              aria-controls="<%= group.to_s.underscore %>">
        <%= group.to_s %>
      </button>
    </h2>
    <div id="<%= group.to_s.underscore %>" class="usa-accordion__content usa-prose">
      <% if histories.any? %>
        <% histories.each do |h| %>
          <p class="line-height-26 margin-top-1"><%= "#{h[:facility]['MailingAddressState']}: #{facility_name_with_common_name(h[:facility]['OfficialStationName'], h[:facility]['CommonName'])}" %></p>
        <% end %>
      <% else %>
        <p>There are no <%= group.to_s.downcase %> adoptions for this practice.</p>
      <% end %>
    </div>
  <% end %>
</div>