<% provide :head_tags do %>
    <%= javascript_tag 'data-turbolinks-track': 'reload' do %>
        <%= render partial: 'impact', formats: [:js] %>
    <% end %>
    <%= javascript_include_tag 'practice_editor_impact', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag '_practice_editor_utilities', 'data-turbolinks-track': 'reload' %>
<% end %>

<%= render 'breadcrumbs' %>
<%= render 'practice_editor_sidenav' %>
<div class="grid-container position-relative">
    <div class="grid-row grid-gap practice-editor-min-height">
        <div class="desktop:grid-col-3 grid-col-auto z-bottom">&nbsp;</div>

        <div id="impact" class="desktop:grid-col-9 grid-col-12 p0">
            <%= render "shared/messages" %>
            <section class="usa-section padding-top-0 p2-bottom impact">
                <h1 class="font-sans-3xl">Impact</h1>
                <h2 class="text-normal margin-bottom-2">
                    Showcase real stories of how your practice is making an impact.
                </h2>
                <%= nested_form_for(@practice, html: { multipart: true, style: 'max-width: 100%', class: 'usa-form', id: 'form'}) do |f| %>
                    <fieldset class="usa-fieldset">
                        <legend class="usa-sr-only">Impact</legend>
                        <h2 class="font-sans-xl margin-bottom-2">Image upload</h2>
                        <ul class="practice-editor-impact-photo-ul" id="sortable_impact_photos" role="listbox" aria-label="Practice editor impact photo list">
                            <%= f.fields_for :impact_photos, wrapper: false do |ip| %>
                                <%
                                    photo_id = ip.object.id
                                    attachment = ip.object.attachment
                                %>
                                <li class="practice-editor-impact-photo-li fields" data-id="<%= photo_id %>">
                                    <%= ip.hidden_field :position, class: 'impact-photo-position' %>
                                    <div class="impact-container padding-205 border border-width-1px border-base-lighter radius-sm margin-top-3">
                                        
                                        <div class="grid-row">
                                            <%= ip.hidden_field :id %>

                                            <div class="grid-col-6">
                                                <% if attachment.present? %>
                                                    <%= image_tag ip.object.attachment_s3_presigned_url, alt: "Impact story picture #{ip.index + 1}", class: 'height-mobile practice-editor-impact-photo radius-md' %>
                                                    <%#= ip.cropbox :attachment, index: ip.index %>
                                                <% else %>
                                                    <div class="bg-base-lightest position-relative radius-md" style="height: 300px; width: 350px;">
                                                        <i class="fas fa-images fa-4x text-base-lighter no-impact-image"></i>
                                                    </div>
                                                <% end %>
                                            </div>
                                            <div class="grid-col-6">
                                                <div class="position-relative">
                                                    <div class="fas fa-arrows-alt font-sans-lg position-arrows impact-arrows text-base arrows-tooltip">
                                                        <span class="usa-tag tooltip-text">Drag and drop to change order</span>
                                                    </div>
                                                </div>
                                                <div class="margin-bottom-205 margin-left-2 margin-top-1">
                                                    <p>• Guidelines for uploading a good image</p>
                                                    <p>• Guidelines for uploading a good image</p>
                                                    <p>• Guidelines for uploading a good image</p>
                                                </div>
                    
                                                <div class="grid-row margin-left-2 flex-align-start">
                                                    <div class="grid-col-fill">
                                                        <div class="margin-bottom-1">
                                                          <%= ip.file_field :attachment, class: 'hidden-upload hidden-impact-photo-upload', accept: 'image/*' %>
                                                          <%= ip.label :attachment, attachment.present? ? 'Upload new photo' : 'Upload photo', class: "usa-button padding-2 add-impact-photo-label" %>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="grid-row width-full">
                                                <div class="grid-col-11">
                                                    <%= ip.label :description, 'Caption:', class: 'usa-label text-bold display-inline-block' %>&nbsp;<span>Share how your practice is making a real-life impact.</span>&nbsp;<span class="text-base-light impact-photo-caption-character-count" <% if photo_id.present? %>id="impact_photo_<%= photo_id %>_caption_character_count"<% end %>>(0/300 characters)</span>
                                                    <%= ip.text_area :description, class: 'usa-input practice-input practice-editor-image-caption height-15', 'counter-id': "impact_photo_#{photo_id}_caption" %>
                                                </div>
                                                
                                                <div class="grid-col-fill flex-align-end impact-trash-container">
                                                    <%= ip.link_to_remove '', class: "fas fa-trash-alt impact-trash text-no-underline margin-left-2", title: 'remove impact photo' %>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                <% end %>
                            </ul>
                            <%= f.link_to_add :impact_photos, class: 'fas fa-plus text-no-underline add-impact-photo-link' do %>
                                <span class="padding-left-1 font-sans-md text-normal text-no-underline">Add another</span>
                            <% end %>
                            
                            <h2 class="font-sans-xl margin-bottom-2 margin-top-1">Video attachment</h2>
                            <ul class="practice-editor-video-file-ul" id="sortable_video_files" role="listbox" aria-label="Practice editor video file list">
                                <%= f.fields_for :video_files, wrapper: false do |vf| %>
                                    <%
                                        video_file_id = vf.object.id
                                        video_attachment = vf.object.attachment
                                        video_file_position = vf.object.position
                                        video_url = vf.object.url
                                    %>
                                    <li class="practice-editor-video-file-li fields" data-id="<%= video_file_id %>">
                                        <%= vf.hidden_field :position, class: 'video-file-position' %>
                                        <div class="impact-container padding-205 border border-width-1px border-base-lighter radius-sm margin-top-3">
                                            <div class="grid-row">
                                                <%= vf.hidden_field :id %>

                                                <div class="grid-col-5">
                                                    <% if video_url.present? %>
                                                        <%= youtube_embed(video_url) %>
                                                    <% else %>
                                                        <div class="bg-base-lightest position-relative" style="height: 225px; width: 284px;">
                                                            <i class="fas fa-play fa-3x text-base-lighter video-file-placeholder"></i>
                                                        </div>
                                                    <% end %>
                                                </div>
                                                <div class="grid-col-7">
                                                    <div class="position-relative">
                                                        <div class="fas fa-arrows-alt font-sans-lg position-arrows impact-arrows text-base arrows-tooltip">
                                                            <span class="usa-tag tooltip-text">Drag and drop to change order</span>
                                                        </div>
                                                    </div>
                                                    <div class="margin-left-2">
                                                        <p>• Guidelines for attaching video link</p>
                                                        <p>• Guidelines for attaching video link</p>
                                                        <p>• Guidelines for attaching video link</p>
                                                    </div>

                                                    <div class="margin-left-2">
                                                        <%= vf.label :url, 'Link:', class: 'usa-label text-bold display-inline-block' %>&nbsp;<span>Type the link to the video.</span>
                                                        <%= vf.text_field :url, class: 'usa-input practice-input video-file-url-input' %>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="grid-row width-full">
                                                <div class="grid-col-11">
                                                    <%= vf.label :description, 'Caption:', class: 'usa-label text-bold display-inline-block' %>&nbsp;<span>Share how your practice is making a real-life impact.</span>&nbsp;<span class="text-base-light video-file-caption-character-count" <% if video_file_id.present? %>id="video_file_<%= video_file_id %>_caption_character_count"<% end %>>(0/300 characters)</span>
                                                    <%= vf.text_area :description, class: 'usa-input practice-input practice-editor-video-caption height-15', 'counter-id': "video_file_#{video_file_id}_caption" %>
                                                </div>
                                                <div class="grid-col-fill flex-align-end impact-trash-container">
                                                    <%= vf.link_to_remove '', class: "fas fa-trash-alt impact-trash text-no-underline margin-left-2", title: 'remove video file' %>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                <% end %>
                            </ul>
                            <%= f.link_to_add :video_files, class: 'fas fa-plus text-no-underline add-video-file-link' do %>
                                <span class="padding-left-1 font-sans-md text-normal text-no-underline">Add another</span>
                            <% end %>
                            <ul class="trash-can display-none"></ul>
                    </fieldset>
                <% end %>
                <div class="grid-row margin-bottom-8">
                    <%= link_to practice_origin_path(@practice), class: 'usa-button usa-button--outline editor-back-to-link margin-right-1 padding-2 margin-bottom-5 text-no-underline' do %>
                        <i class="fas fa-chevron-left fa-sm text-no-underline margin-right-1"></i>Back
                    <% end %>
                    <%= link_to practice_documentation_path(@practice), class: 'usa-button padding-2 editor-continue-link margin-right-1 margin-bottom-5' do %>
                        Continue<i class="fas fa-chevron-right fa-sm margin-left-1 text-no-underline"></i>
                    <% end %>
                </div>
            </section>
        </div>
    </div>
    <div class="margin-bottom-105">
        <button class="usa-button usa-button--unstyled return-to-top">Return to top</button>
    </div>
</div>