/*!
 * showMoreItem.js Version:1.0.1
 * @copyright 2020 PeggyHsieh
 * @license MIT (https://github.com/peggy-hsieh/showMoreItems)
 */
// !function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"undefined"!=typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function($){var ShowMoreItems=window.ShowMoreItems||{},ShowMoreItems=function(t,e){$(t).addClass("showMoreItemsList");var o=this,r={nowNum:1,startNum:1,afterNum:1,original:!1,moreText:"Show more",noMoreText:"No more",backMoreText:"Take back",responsive:""},n=$(t).data("showMoreItems")||{};o.defaults=$.extend({},r,e,n),o.options=$.extend({},r,e,n),o.registerBreakpoints(t),o.init(t)};ShowMoreItems.prototype.init=function(t){var e=this;return e.sum=$(t).children().length,e.runData(t,e),!1},ShowMoreItems.prototype.runData=function(o,r){var n=this;n.goOut=!1,$(o).children().hide(),$(o).next(".button-box").remove(),n.nowNum=r.options.nowNum-1,n.goNum=n.nowNum+r.options.startNum,n.sum<=r.options.startNum&&(n.goNum=n.sum,n.goOut=!0);for(var t=n.nowNum;t<n.goNum;t++)$(o).children().eq(t).show(),n.nowNum+=1;n.goOut||$(o).after('<div class="button-box p1-75-top"><button class="addListData usa-button--outline dm-btn-base display-block margin-x-auto">'+r.options.moreText+"</button></div><div class='dm-loading-spinner display-none flex-justify-center flex-align-self-center margin-y-4'><i class='fas fa-circle-notch'></i></div>"),$(o).next().on("click",".addListData",function(t){n.goNum=n.nowNum+r.options.afterNum,n.sum<=n.goNum&&(n.goNum=n.sum,n.goOut=!0);for(var e=n.nowNum;e<n.goNum;e++)$(o).children().eq(e).show(),n.nowNum+=1;n.goOut&&r.options.original?$(this).text(r.options.backMoreText).addClass("original"):n.goOut&&$(this).text(r.options.noMoreText)}),$(o).next().on("click",".original",function(t){return $(this).removeClass("original"),n.reflesh($(this)),!1})},ShowMoreItems.prototype.reflesh=function(t){thisE=t.parent().prev(),t.remove(),this.registerBreakpoints(t),this.init(thisE)},ShowMoreItems.prototype.registerBreakpoints=function(t){var o=this;o.options.responsive&&(ResponsiveArr=o.options.responsive,ResponsiveArr=ResponsiveArr.sort(function(t,e){return t.breakpoint>e.breakpoint?-1:1}),o.options.responsive=ResponsiveArr,o.Oindex=-1,o.Owidth=$(window).width(),$.each(o.options.responsive,function(t,e){$(window).width()<=e.breakpoint&&(o.Oindex=t,e=e.settings,o.options=$.extend({},o.options,e))}),$(window).resize(function(){return run=!1,$(window).width()<o.Owidth&&(o.Owidth=$(window).width(),$.each(o.options.responsive,function(t,e){if(o.Owidth<=e.breakpoint&&o.Oindex<t)return o.Oindex=t,e=e.settings,o.options=$.extend({},o.options,o.defaults),o.options=$.extend({},o.options,e),run=!0,o.Oindex})),$(window).width()>o.Owidth&&(o.Owidth=$(window).width(),$.each(ResponsiveArr,function(t,e){if(o.Owidth>e.breakpoint&&o.Oindex>t-1)return o.Oindex=t-1,run=(-1!=o.Oindex?(e=ResponsiveArr[t-1].settings,o.options=$.extend({},o.options,o.defaults),o.options=$.extend({},o.options,e)):o.options=$.extend({},o.options,o.defaults),!0),o.Oindex})),1==run&&o.runData(t,o),!1}))},$.fn.showMoreItems=function(){for(var t,e=this,o=arguments[0],r=Array.prototype.slice.call(arguments,1),n=e.length,s=0;s<n;s++)if("object"==typeof o||void 0===o?e[s].showMoreItems=new ShowMoreItems(e[s],o):t=e[s].showMoreItems[o].apply(e[s].showMoreItems,r),void 0!==t)return t;return e},$(function(){var settings;$('[data-showMoreItems="true"]').length&&(selecter=$('[data-showMoreItems="true"]'),"true"==selecter.attr("data-showMoreItems")&&(settings={nowNum:1,getView:0,startNum:1,afterNum:1,original:!1,moreText:"更多Show more",noMoreText:"沒有更多No more",backMoreText:"收回Take back",responsive:""},selecter.attr("data-nowNum")&&(settings.nowNum=parseInt(selecter.attr("data-nowNum"))),selecter.attr("data-startNum")&&(settings.startNum=parseInt(selecter.attr("data-startNum"))),selecter.attr("data-afterNum")&&(settings.afterNum=parseInt(selecter.attr("data-afterNum"))),selecter.attr("data-original")&&(settings.original=Boolean(selecter.attr("data-original"))),selecter.attr("data-moreText")&&(settings.moreText=selecter.attr("data-moreText")),selecter.attr("data-noMoreText")&&(settings.noMoreText=selecter.attr("data-noMoreText")),selecter.attr("data-backMoreText")&&(settings.backMoreText=selecter.attr("data-backMoreText")),selecter.attr("data-responsive")&&(settings.responsive=eval(selecter.attr("data-responsive")))),$('[data-showMoreItems="true"]').showMoreItems(settings))})});


/*!
 * showMoreItem.js Version:1.0.1
 * @copyright 2020 PeggyHsieh
 * @license MIT (https://github.com/peggy-hsieh/showMoreItems)
 */

var buttonBox = '.button-box'
var loadingSpinner = '.dm-loading-spinner'

;(function(factory) {
    if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else if (typeof exports !== 'undefined') {
        module.exports = factory(require('jquery'));
    } else {
        factory(jQuery);
    }

}(function($) {
    var ShowMoreItems = window.ShowMoreItems || {};
    ShowMoreItems = (function() {
        var instanceUid = 0;
        function ShowMoreItems(element, settings) {
            $(element).addClass('showMoreItemsList')
            var _ = this, dataSettings;
            var defaults = {
                nowNum:1,
                //getView:0,
                startNum:1,
                afterNum:1,
                original:false,
                moreText:'Show more',
                noMoreText:'No more',
                backMoreText:'Take back',
                responsive:''
            }
            dataSettings = $(element).data('showMoreItems') || {};
            _.defaults = $.extend({}, defaults, settings, dataSettings);
            _.options = $.extend({}, defaults, settings, dataSettings);
            _.registerBreakpoints(element);
            _.init(element);
        }
        return ShowMoreItems;
    }());
    ShowMoreItems.prototype.init = function(element) {
        var _ = this;
        _.sum = $(element).children().length
        _.runData(element, _);
        return false
    };
    ShowMoreItems.prototype.runData = function(element, settings) {
        var _ = this;
        _.goOut=false;
        $(element).children().hide()
        $(element).next(buttonBox).remove()
        _.nowNum =settings.options.nowNum -1
        _.goNum = _.nowNum + settings.options.startNum
        if(_.sum<=settings.options.startNum){
            _.goNum=_.sum;
            _.goOut=true;
        }
        for (var i = _.nowNum; i < _.goNum; i++) {
            $(element).children().eq(i).show()
            _.nowNum+=1;
        }
        console.log('goOut', _.goOut)
        if(!_.goOut){
            console.log('element', $(element))
            $(element).after(
                '<div class="button-box p1-75-top"><button class="addListData usa-button--outline dm-btn-base display-block margin-x-auto">' + settings.options.moreText + '</button></div>' +
                '<div class="dm-loading-spinner display-none flex-justify-center flex-align-self-center margin-y-4"><i class="fas fa-circle-notch"></i></div>'
            );
        }

        // Only allow one loading spinner to be created at a time
        if ($(element).parent().find(loadingSpinner).length > 1) {
            $(element).parent().find(loadingSpinner).last().remove()
        }
        $(element).next().on('click','.addListData', function(event) {
            $(this).closest('section').find(loadingSpinner).removeClass('display-none');
            $(this).closest('section').find(loadingSpinner).addClass('display-flex');
            $(buttonBox).addClass('display-none');
            _.goNum = _.nowNum + settings.options.afterNum
            if (_.sum <= _.goNum) {
                _.goNum = _.sum
                _.goOut = true
            }
            setTimeout(function() {
                for (var i = _.nowNum; i < _.goNum; i++) {
                    $(element).children().eq(i).show()
                    _.nowNum += 1
                    $('.addListData').closest('section').find(loadingSpinner).addClass('display-none');
                    $(buttonBox).removeClass('display-none');
                    // If there are no more practice cards to show, hide the 'No more results' button
                    if (_.nowNum === _.sum) {
                        $(buttonBox).addClass('display-none');
                    }
                }
                // Truncate the text of the next set of cards
                truncateText();
            }, 2000)

            if (_.goOut && settings.options.original) {
                $(this).text(settings.options.backMoreText).addClass('original')
            } else if (_.goOut) {
                $(this).text(settings.options.noMoreText)
            }
        });
        $(element).next().on('click','.original', function(event) {
            $(this).removeClass('original');
            _.reflesh($(this));
            return false
        });
    };
    ShowMoreItems.prototype.reflesh = function(element) {
        var _ = this;
        thisE = element.parent().prev();
        element.remove();
        _.registerBreakpoints(element);
        _.init(thisE);
    }

    ShowMoreItems.prototype.registerBreakpoints = function(element) {
        var _ = this;
        if(_.options.responsive){
            ResponsiveArr = _.options.responsive
            //排序
            ResponsiveArr = ResponsiveArr.sort(function (a, b) {
                return a.breakpoint > b.breakpoint ? -1 : 1;
            });
            _.options.responsive = ResponsiveArr
            _.Oindex = -1
            _.Owidth = $(window).width()
            $.each(_.options.responsive, function(index, value) {
                if($(window).width()<=value.breakpoint){
                    _.Oindex= index
                    value = value.settings
                    _.options = $.extend({}, _.options, value);
                }
            });
            $(window).resize(function() {
                run=false
                if($(window).width() <_.Owidth){
                    _.Owidth = $(window).width()
                    $.each(_.options.responsive, function(index, value) {
                        if(_.Owidth<=value.breakpoint && _.Oindex < index){
                            _.Oindex= index
                            value = value.settings
                            _.options = $.extend({}, _.options, _.defaults);
                            _.options = $.extend({}, _.options, value);
                            run=true
                            return _.Oindex
                        }
                    });
                }
                if($(window).width() >_.Owidth){
                    _.Owidth = $(window).width()
                    $.each(ResponsiveArr, function(index, value) {
                        if(_.Owidth>value.breakpoint && _.Oindex > index-1){
                            _.Oindex= index-1
                            if(_.Oindex!=-1){
                                value = ResponsiveArr[index-1].settings
                                _.options = $.extend({}, _.options, _.defaults);
                                _.options = $.extend({}, _.options, value);
                                run=true
                            }else{
                                _.options = $.extend({}, _.options, _.defaults);
                                run=true
                            }
                            return _.Oindex
                        }
                    });
                }
                if(run==true){
                    _.runData(element, _);
                }
                return false
            });
        }
    };
    $.fn.showMoreItems = function() {
        var _ = this,
            opt = arguments[0],
            args = Array.prototype.slice.call(arguments, 1),
            l = _.length,
            i,
            ret;
        for (i = 0; i < l; i++) {
            if (typeof opt == 'object' || typeof opt == 'undefined')
                _[i].showMoreItems = new ShowMoreItems(_[i], opt);
            else
                ret = _[i].showMoreItems[opt].apply(_[i].showMoreItems, args);
            if (typeof ret != 'undefined') return ret;
        }
        return _;
    };
    $( function () {
        if($('[data-showMoreItems="true"]').length){
            selecter =$('[data-showMoreItems="true"]')
            if(selecter.attr('data-showMoreItems')=='true'){
                var settings = {
                    nowNum:1,
                    getView:0,
                    startNum:1,
                    afterNum:1,
                    original:false,
                    moreText:'Show more',
                    noMoreText:'No more',
                    backMoreText:'Take back',
                    responsive:''
                }
                if(selecter.attr('data-nowNum')){
                    settings.nowNum=parseInt(selecter.attr('data-nowNum'))
                }
                if(selecter.attr('data-startNum')){
                    settings.startNum=parseInt(selecter.attr('data-startNum'))
                }
                if(selecter.attr('data-afterNum')){
                    settings.afterNum=parseInt(selecter.attr('data-afterNum'))
                }
                if(selecter.attr('data-original')){
                    settings.original=Boolean(selecter.attr('data-original'))
                }
                if(selecter.attr('data-moreText')){
                    settings.moreText=selecter.attr('data-moreText')
                }
                if(selecter.attr('data-noMoreText')){
                    settings.noMoreText=selecter.attr('data-noMoreText')
                }
                if(selecter.attr('data-backMoreText')){
                    settings.backMoreText=selecter.attr('data-backMoreText')
                }
                if(selecter.attr('data-responsive')){
                    settings.responsive=eval(selecter.attr('data-responsive'))
                }
            }
            $('[data-showMoreItems="true"]').showMoreItems(settings);
        }
    });
}));