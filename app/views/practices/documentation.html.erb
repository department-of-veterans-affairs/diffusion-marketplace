<% provide :head_tags do %>
    <%= javascript_tag 'data-turbolinks-track': 'reload' do %>
        <%= render partial: 'documentation', formats: [:js] %>
    <% end %>
    <%= javascript_include_tag 'practice_editor_documentation', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag '_practice_utilities', 'data-turbolinks-track': 'reload' %>
<% end %>

<%= render 'breadcrumbs' %>
<%= render 'practice_editor_sidenav' %>
<div class="grid-container position-relative">
    <div class="grid-row grid-gap practice-editor-min-height">
        <div class="desktop:grid-col-3 grid-col-auto z-bottom">&nbsp;</div>

        <div id="documentation" class="desktop:grid-col-9 grid-col-12 p0">
            <%= render partial: "shared/messages", locals: {small_text: false} %>
            <section class="usa-section padding-top-0 p0-bottom documentation">
                <h1 class="font-sans-2xl line-height-sans-205">Documentation&nbsp;<span class="text-base">(optional)</span></h1>
                <h2 class="text-normal margin-bottom-5">
                    Upload files and web links that are relevant to your practice.
                </h2>
                <%= render 'pii_phi_alert' %>
                <%= nested_form_for(@practice, html: { multipart: true, style: 'max-width: 100%', class: 'usa-form', id: 'form'}) do |f| %>
                    <fieldset class="usa-fieldset">
                        <legend class="usa-sr-only">Documentation</legend>

                        <h2 class="font-sans-xl">File upload</h2>

                        <ul class="practice-editor-additional-document-ul" id="sortable_additional_documents" role="listbox" aria-label="Practice editor additional document list">
                        <%= f.fields_for :additional_documents, wrapper: false do |ad| %>
                            <%
                                ad_id = ad.object.id
                                attachment = ad.object.attachment
                            %>

                            <li class="practice-editor-additional-document-li fields" data-id="<%= ad_id %>">
                                <%= ad.hidden_field :position, class: 'additional-document-position' %>
                                <div class="documentation-container padding-205 border border-width-1px border-base-lighter radius-sm margin-top-3">
                                    <div class="position-relative">
                                        <div class="fas fa-arrows-alt font-sans-lg position-arrows documentation-arrows text-base arrows-tooltip">
                                            <span class="usa-tag tooltip-text">Drag and drop to change order</span>
                                        </div>
                                        <%= ad.label :title, 'Title:', class: 'usa-label add-doc-title text-bold display-inline-block' %>&nbsp;<span>Type the name of the file.</span>&nbsp;<span class="text-base-light additional-document-title-character-count" <% if ad_id.present? %>id="additional_document_<%= ad_id %>_title_character_count"<% end %>>(0/50 characters)</span>
                                        <%= ad.text_field :title, class: 'usa-input practice-input width-tablet additional-document-title-input', 'counter-id': "additional_document_#{ad_id}_title" %>
                                    </div>
                                    <div class="grid-row width-full">
                                        <div class="grid-col-11">
                                            <p class="text-bold margin-top-3 <%= attachment.present? ? 'margin-bottom-1' : '' %>" %>File:&nbsp;<span class="text-normal">You can upload a .pdf, .docx, .xlsx, .jpg, .jpeg, or .png file that is less than 32MB.</span></p>
                                            <% if attachment.present? %>
                                                <i class="fas fa-file"></i>
                                                <%= link_to ad.object.attachment_s3_presigned_url, target: :_blank, class: 'dm-font-color-blue-50v margin-top-1 margin-left-05' do %>
                                                    <%= ad.object.attachment_file_name %>
                                                <% end %>
                                            <% end %>
                                            <div>
                                              <%= ad.label :attachment, attachment.present? ? 'Upload new file' : 'Upload file', class: 'usa-button usa-button--unstyled add-documentation-label' %>
                                              <%= ad.file_field :attachment, class: 'hidden-upload hidden-new-documentation-field', accept: '.pdf,.doc,.docx' %>
                                            </div>
                                        </div>
                                        <div class="grid-col-fill flex-align-end documentation-trash-container">
                                            <%= ad.link_to_remove '', class: "fas fa-trash-alt documentation-trash text-no-underline", title: 'remove additional document' %>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        <% end %>
                        </ul>
                        <%= f.link_to_add :additional_documents, class: 'fas fa-plus text-no-underline add-additional-document-link' do %>
                            <span class="padding-left-1 font-sans-md text-normal text-no-underline">Add file</span>
                        <% end %>

                        <h2 class="font-sans-xl margin-top-0">Link attachment</h2>

                        <ul class="practice-editor-publication-ul" id="sortable_publications" role="listbox" aria-label="Practice editor publication list">
                        <%= f.fields_for :publications, wrapper: false do |pub| %>
                            <%
                                pub_id = pub.object.id
                            %>

                            <li class="practice-editor-publication-li fields" data-id="<%= pub_id %>">
                                <%= pub.hidden_field :position, class: 'publication-position' %>
                                <div class="documentation-container padding-205 border border-width-1px border-base-lighter radius-sm margin-top-3">
                                    <div class="position-relative">
                                        <div class="position-relative">
                                            <div class="fas fa-arrows-alt font-sans-lg position-arrows documentation-arrows text-base arrows-tooltip">
                                                <span class="usa-tag tooltip-text">Drag and drop to change order</span>
                                            </div>
                                            <%= pub.label :title, 'Title:', class: 'usa-label pub-title text-bold display-inline-block' %>&nbsp;<span>Type the name of the web link.</span>&nbsp;<span class="text-base-light publication-title-character-count" <% if pub_id.present? %>id="publication_<%= pub_id %>_title_character_count"<% end %>>(0/50 characters)</span>
                                            <%= pub.text_field :title, class: 'usa-input practice-input width-tablet publication-title-input', 'counter-id': "publication_#{pub_id}_title" %>
                                        </div>
                                    </div>
                                    <div class="grid-row">
                                        <div class="margin-bottom-1">
                                            <%= pub.label :link, 'Link:', class: 'usa-label pub-link text-bold display-inline-block' %>&nbsp;<span>Paste the full web address.</span>
                                            <%= pub.text_field :link, class: 'usa-input practice-input width-tablet publication-link-input' %>
                                        </div>
                                        <div class="grid-col-fill flex-align-end documentation-trash-container">
                                            <%= pub.link_to_remove '', class: "fas fa-trash-alt documentation-trash text-no-underline", title: 'remove publication' %>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        <% end %>
                        </ul>
                        <%= f.link_to_add :publications, class: 'fas fa-plus text-no-underline add-publication-link' do %>
                            <span class="padding-left-1 font-sans-md text-normal text-no-underline">Add link</span>
                        <% end %>
                        <ul class="trash-can display-none"></ul>

                    </fieldset>
                <% end %>
                <div class="grid-row">
                    <%= link_to practice_impact_path(@practice), class: 'usa-button usa-button--outline editor-back-to-link margin-right-1 padding-2 text-no-underline' do %>
                        <i class="fas fa-chevron-left fa-sm text-no-underline margin-right-1"></i>Back
                    <% end %>
                    <%= link_to practice_resources_path(@practice), class: 'usa-button padding-2 editor-continue-link continue-and-save margin-right-1' do %>
                        Continue<i class="fas fa-chevron-right fa-sm margin-left-1 text-no-underline"></i>
                    <% end %>
                </div>
            </section>
        </div>
    </div>
</div>